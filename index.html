<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Inscripci√≥n Cena üéâ</title>
  <style>
    body { font-family: system-ui, Arial; max-width: 600px; margin: 2rem auto; padding: 1rem; }
    form { display: flex; flex-direction: column; gap: 1rem; }
    label { font-weight: bold; }
    input, select { padding: 0.5rem; font-size: 1rem; }
    button { padding: 0.7rem; font-size: 1rem; background: #457b9d; color: white; border: none; border-radius: 6px; cursor: pointer; }
    button:hover { background: #1d3557; }
    .info { font-size: 0.9rem; color: #555; }
  </style>
</head>
<body>
  <h1>Formulario de Inscripci√≥n ‚Äì Cena de Fin de A√±o üéâ</h1>

  <form id="inscripcionForm">
    <div>
      <label>Nombre y Apellido</label>
      <input type="text" id="nombre" required />
    </div>

    <div>
      <label>DNI</label>
      <input type="text" id="dni" required />
    </div>

    <div>
      <label>Correo electr√≥nico</label>
      <input type="email" id="correo" required />
    </div>

    <div>
      <label>Lugar de trabajo</label>
      <input type="text" id="lugar" required />
    </div>

    <div>
      <label>Cantidad de opciones</label>
      <input type="number" id="cantidad" min="1" value="1" required />
      <p class="info">üí∞ Precio por opci√≥n: $40.000</p>
    </div>

    <div>
      <label>
        <input type="checkbox" id="acepto" required />
        Acepto que el valor total se descuente por planilla de haberes en 4 cuotas
      </label>
    </div>

    <button type="submit">Enviar inscripci√≥n</button>
  </form>

  <p id="out"></p>

  <script>
    const SUPABASE_URL = "https://dlitmctfjzmedssrbazs.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRsaXRtY3RmanptZWRzc3JiYXpzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg3MTAwNTQsImV4cCI6MjA3NDI4NjA1NH0.ciennL_O5fphj1x_DQ18jW-awBYIWjXRgs5Oxk31TQQ";
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzxKjO6AmgHRwFeMe5YwSnyl9MIqWg6KFF-rTOyUg7PM9kK5rS83BwsL9EF1JU655mF/exec"; // ‚ö†Ô∏è tu WebApp

    document.getElementById("inscripcionForm").addEventListener("submit", async (e) => {
      e.preventDefault();

      const payload = {
        nombre: document.getElementById("nombre").value.trim(),
        dni: document.getElementById("dni").value.trim(),
        correo: document.getElementById("correo").value.trim(),
        lugar: document.getElementById("lugar").value.trim(),
        cantidad: parseInt(document.getElementById("cantidad").value, 10)
      };

      try {
        // 1) Guardar en Supabase
        let res1 = await fetch(`${SUPABASE_URL}/rest/v1/inscriptos`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "apikey": SUPABASE_KEY,
            "Authorization": "Bearer " + SUPABASE_KEY,
            "Prefer": "return=minimal"
          },
          body: JSON.stringify(payload)
        });

        if (!res1.ok) throw new Error("Error guardando en Supabase");

        // 2) Mandar correo v√≠a Google Script
        let res2 = await fetch(SCRIPT_URL, {
          method: "POST",
          body: JSON.stringify(payload)
        });

        if (!res2.ok) throw new Error("Error enviando correo");

        document.getElementById("out").textContent = "‚úÖ Inscripci√≥n enviada. Revis√° tu correo.";
        e.target.reset();
      } catch (err) {
        console.error(err);
        document.getElementById("out").textContent = "‚ùå Hubo un problema: " + err.message;
      }
    });
  </script>
</body>
</html>
